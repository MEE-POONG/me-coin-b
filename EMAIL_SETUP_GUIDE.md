# üìß Email Setup Guide - MeCoins

## ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Gmail SMTP ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á Email

---

## üéØ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

‡∏£‡∏∞‡∏ö‡∏ö MeCoins ‡πÉ‡∏ä‡πâ **Gmail SMTP** ‡∏ú‡πà‡∏≤‡∏ô Nodemailer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á email ‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡πà‡∏≤‡∏á‡πÜ:

1. ‚úÖ Reset Password (‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô)
2. ‚úÖ Deposit Approved (‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô)
3. ‚úÖ Deposit Rejected (‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏ù‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô)
4. ‚úÖ Withdrawal Approved (‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ñ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô)
5. ‚úÖ Welcome Email (‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà)
6. ‚úÖ Transaction Notification (‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°)

---

## üîß ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Gmail

### Step 1: ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô 2-Factor Authentication

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà [Google Account Security](https://myaccount.google.com/security)
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "2-Step Verification"
3. ‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

---

### Step 2: ‡∏™‡∏£‡πâ‡∏≤‡∏á App Password

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà [Google Account](https://myaccount.google.com/)
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Security" (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
3. ‡πÉ‡∏ô "How you sign in to Google" ‡∏´‡∏≤ "2-Step Verification"
4. ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏•‡πà‡∏≤‡∏á‡∏´‡∏≤ **"App passwords"**
5. ‡∏Ñ‡∏•‡∏¥‡∏Å "App passwords"
6. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:
   - **App**: Mail
   - **Device**: Other (Custom name)
7. ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠: "MeCoins Server"
8. ‡∏Ñ‡∏•‡∏¥‡∏Å "Generate"
9. **‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å password ‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á** (16 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á App Password:**
```
abcd efgh ijkl mnop
```

---

### Step 3: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment Variables

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå `.env`:

```env
# Email Configuration
EMAIL_USER="me.prompt.tec@gmail.com"
EMAIL_PASSWORD="abcdefghijklmnop"  # App Password ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Step 2 (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ)
```

**‚ö†Ô∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:**
- ‡πÉ‡∏ä‡πâ **App Password** ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Gmail ‡∏õ‡∏Å‡∏ï‡∏¥
- ‡∏•‡∏ö‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å App Password
- ‡∏≠‡∏¢‡πà‡∏≤ commit .env ‡πÄ‡∏Ç‡πâ‡∏≤ Git

---

### Step 4: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á Email

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `scripts/test-email.ts`:

```typescript
import { sendEmail, EmailTemplates } from '../lib/email'

async function testEmail() {
  try {
    const template = EmailTemplates.welcome('TestUser', 'test@example.com')
    
    const result = await sendEmail({
      to: 'recipient@example.com', // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô email ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
      subject: template.subject,
      html: template.html,
    })

    if (result.success) {
      console.log('‚úÖ Email sent successfully!')
    } else {
      console.log('‚ùå Failed to send email')
    }
  } catch (error) {
    console.error('Error:', error)
  }
}

testEmail()
```

‡∏£‡∏±‡∏ô:
```bash
npx ts-node scripts/test-email.ts
```

---

## üìß Email Templates ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

### 1. Reset Password Email
```typescript
import { sendEmail, EmailTemplates } from '@/lib/email'

const template = EmailTemplates.resetPassword(
  username,
  `${process.env.NEXTAUTH_URL}/forgot-password?token=${token}`
)

await sendEmail({
  to: user.email,
  ...template,
})
```

### 2. Deposit Approved Email
```typescript
const template = EmailTemplates.depositApproved(
  user.username,
  deposit.amount,
  wallet.balance
)

await sendEmail({
  to: user.email,
  ...template,
})
```

### 3. Deposit Rejected Email
```typescript
const template = EmailTemplates.depositRejected(
  user.username,
  deposit.amount,
  deposit.comment // ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•
)

await sendEmail({
  to: user.email,
  ...template,
})
```

### 4. Withdrawal Approved Email
```typescript
const template = EmailTemplates.withdrawalApproved(
  user.username,
  withdrawal.amount,
  wallet.balance
)

await sendEmail({
  to: user.email,
  ...template,
})
```

### 5. Welcome Email
```typescript
const template = EmailTemplates.welcome(
  user.username,
  user.email
)

await sendEmail({
  to: user.email,
  ...template,
})
```

### 6. Transaction Notification
```typescript
const template = EmailTemplates.transaction(
  user.username,
  'DEPOSIT', // or 'WITHDRAWAL', 'PURCHASE', etc.
  amount,
  balance
)

await sendEmail({
  to: user.email,
  ...template,
})
```

---

## üîå ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° Email ‡πÉ‡∏ô API

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏™‡πà‡∏á Email ‡πÄ‡∏°‡∏∑‡πà‡∏≠ Deposit Approved

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `app/api/deposits/[id]/route.ts`:

```typescript
import { sendEmail, EmailTemplates } from '@/lib/email'

// ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å approve deposit
if (status === 'APPROVED') {
  // ... update wallet ‡πÅ‡∏•‡∏∞ transaction ...
  
  // ‡∏™‡πà‡∏á email
  const updatedWallet = await prisma.wallet.findUnique({
    where: { userId: deposit.userId },
  })
  
  const template = EmailTemplates.depositApproved(
    deposit.user.username,
    deposit.amount * deposit.rate,
    updatedWallet?.balance || 0
  )
  
  await sendEmail({
    to: deposit.user.email,
    ...template,
  })
}
```

---

## üö® Troubleshooting

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Error: Invalid login

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:**
- ‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Gmail ‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏ó‡∏ô App Password
- App Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î 2FA

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡∏¥‡∏î 2FA ‡πÅ‡∏•‡πâ‡∏ß
2. ‡∏™‡∏£‡πâ‡∏≤‡∏á App Password ‡πÉ‡∏´‡∏°‡πà
3. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å App Password ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ)

---

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Error: Connection timeout

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:**
- Firewall block port 587 ‡∏´‡∏£‡∏∑‡∏≠ 465
- Network ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ SMTP

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
```typescript
// ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô config
const transporter = nodemailer.createTransport({
  host: 'smtp.gmail.com',
  port: 587,
  secure: false, // true ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 465, false ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 587
  auth: {
    user: process.env.EMAIL_USER,
    pass: process.env.EMAIL_PASSWORD,
  },
})
```

---

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Email ‡πÑ‡∏õ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô Spam

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:**
1. ‡πÄ‡∏û‡∏¥‡πà‡∏° SPF record ‡πÉ‡∏ô domain
2. ‡πÉ‡∏ä‡πâ verified sender address
3. ‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á spam keywords
4. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô

---

## üé® Customization

### ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Email Sender Name
```typescript
// ‡πÉ‡∏ô lib/email.ts
from: `"MeCoins - ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï" <${process.env.EMAIL_USER}>`,
```

### ‡πÄ‡∏û‡∏¥‡πà‡∏° Email Template ‡πÉ‡∏´‡∏°‡πà
```typescript
// ‡πÉ‡∏ô lib/email.ts - EmailTemplates
export const EmailTemplates = {
  // ... existing templates ...
  
  customNotification: (username: string, message: string) => ({
    subject: 'üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô - MeCoins',
    html: `
      <div style="...">
        <p>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ${username},</p>
        <p>${message}</p>
      </div>
    `,
  }),
}
```

---

## üìä Email Tracking (Optional)

### ‡πÄ‡∏û‡∏¥‡πà‡∏° Model ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° Email

```prisma
model EmailLog {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  userId    String   @db.ObjectId
  user      User     @relation(fields: [userId], references: [id])
  to        String
  subject   String
  type      String   // "RESET_PASSWORD", "DEPOSIT_APPROVED", etc.
  sent      Boolean  @default(false)
  sentAt    DateTime?
  error     String?
  createdAt DateTime @default(now())
  
  @@map("email_logs")
}
```

---

## üîí Security Best Practices

### ‚úÖ Do's:
1. ‡πÉ‡∏ä‡πâ App Password (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á)
2. ‡πÄ‡∏Å‡πá‡∏ö credentials ‡πÉ‡∏ô .env
3. ‡πÄ‡∏û‡∏¥‡πà‡∏° .env ‡πÉ‡∏ô .gitignore
4. ‡πÉ‡∏ä‡πâ HTTPS ‡πÉ‡∏ô production
5. Validate email addresses

### ‚ùå Don'ts:
1. ‡∏≠‡∏¢‡πà‡∏≤ commit EMAIL_PASSWORD ‡πÄ‡∏Ç‡πâ‡∏≤ Git
2. ‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô Gmail ‡∏õ‡∏Å‡∏ï‡∏¥
3. ‡∏≠‡∏¢‡πà‡∏≤‡∏™‡πà‡∏á email ‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (rate limit)
4. ‡∏≠‡∏¢‡πà‡∏≤ hardcode email addresses

---

## üìà Rate Limiting

Gmail SMTP ‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï:
- **‡∏ü‡∏£‡∏µ**: 500 emails/day
- **Google Workspace**: 2,000 emails/day

‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏µ‡πâ ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ:
- SendGrid
- AWS SES
- Mailgun
- Postmark

---

## üéØ Next Steps

### 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Gmail App Password
```bash
# ‡∏ó‡∏≥‡∏ï‡∏≤‡∏° Step 1-2 ‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô
```

### 2. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï .env
```env
EMAIL_USER="me.prompt.tec@gmail.com"
EMAIL_PASSWORD="your-app-password-here"
```

### 3. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á nodemailer
```bash
npm install
```

### 4. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á Email
```bash
npx ts-node scripts/test-email.ts
```

### 5. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á Email ‡πÉ‡∏ô API
- Forgot Password ‚úÖ (‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß)
- Deposit Approved ‚ú® (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°)
- Withdrawal Approved ‚ú® (‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°)

---

## üí° Tips

1. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á**: ‡∏™‡πà‡∏á‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô
2. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Spam folder**: Email ‡∏≠‡∏≤‡∏à‡πÑ‡∏õ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô spam
3. **‡πÉ‡∏ä‡πâ HTML Templates**: ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡πÅ‡∏•‡∏∞ professional
4. **Log ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á**: ‡πÄ‡∏û‡∏∑‡πà‡∏≠ debug ‡∏á‡πà‡∏≤‡∏¢
5. **Handle errors**: ‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏´‡πâ email failure ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πà‡∏°

---

## üìö Resources

- [Nodemailer Documentation](https://nodemailer.com/)
- [Gmail SMTP Settings](https://support.google.com/mail/answer/7126229)
- [Google App Passwords](https://support.google.com/accounts/answer/185833)

---

**‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á Email ‡πÅ‡∏•‡πâ‡∏ß! üìß**

